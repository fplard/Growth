---
title: "Useful Functions"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{useful-functions}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(Growth)
```

<!-- WARNING - This vignette is generated by {fusen} from dev/flat_nimble.Rmd: do not edit by hand -->

This vignette presents a collection of useful functions used in the main functions of this package to run nimble models and get simplified outputs. They usually do not need to be run on their own.




## Manipulate nimble outputs

### Estimate Rhat values

The function `Rhatfun()` allows to take outputs of nimble chains and to estimate Rubin Gelman convergence statistics.


```{r example-Rhatfun}
rb = array(rnorm(15*3*4), dim = c(15,3,4))
Rhatfun(rb, nch = 3, it = 15, nparam = 4)

```

### Summary

The function `sum_nim()` makes a summary table with main statistics for each parameter from output chains of a Bayesian model



```{r example-sum_nim}
rb = array(rnorm(15*3*4), dim = c(15,3,4))
sum_nim(rb, nch = 3)

```

## Histogram for posterior distribution

The function `hist_post()` prepares a histogram ggplot for posterior distribution of a given parameter. It can be used within codes for plotting grids of posterior distributions of several parameters. It takes a numeric vector `x` as argument.



```{r example-hist_post}
hist_post(rnorm(1000))
```

## Plots for convergence

The function `conv_plot()` prepares a ggplot to loog at convergence of posterior distribution of a given parameter. It takes a numeric vector `x` as argument and `m` the number of iteration.



```{r example-conv_plot}
conv_plot(rnorm(1500), m =500)
```

# Write nimble codes

The function `Gro_writenimblecode()` writes a nimble code for a growth model including individual random effect. It takes as argument:

* `params` names of all parameters of the model. 
* `model` likelihood of the nimble model
* `random`  name of the parameters that must include an individual random effect
* `maxval` list including the maximum values for prior for each parameter
* `minval` list including the minimum values for prior for each parameter



```{r example-esw_writenimblecode}
#Example for a von bertalanffy model
Gro_writenimblecode(params = c('z0', 'zinf', 'gamma'), 
                    model = "for (j in 1:N){{
<<<<<<< HEAD
       logz[j] ~dnorm(z0[IND[j]] + zinf[IND[j]] * 
       (1 - exp(- gamma[IND[j]] * logx[j])), sigma_res)}}",
=======
       logz[j] ~dnorm(z0[IND[j]] + zinf[IND[j]] * (1 - exp(- gamma[IND[j]] * logx[j])), sigma_res)}}",
>>>>>>> 477a9e1177176026d2b387122272aa26e641282b
                    random = "gamma",
                    maxval = list(z0 = 5), 
                    minval= list(z0 = 0, zinf = 0, gamma = 0)
)
```

